<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CHOMPOCALIPSE â€“ Ripple Games</title>
  <link rel="stylesheet" href="/css/styles.css" />
</head>
<body class="page--game">
<header class="nav">
  <div class="nav__inner">

    <div class="nav__left">
      <img src="/img/logo.png" alt="Ripple Games logo" class="logo" />
      <a class="nav__link" href="/">Ripple Games</a>
    </div>
    <nav class="nav__right">
      <a class="nav__link" href="/#about">About Us</a>
      <a class="nav__link" href="/#contact">Contact</a>
      <span class="nav__lang">EN <span aria-hidden="true">|</span> GE</span>
    </nav>
  </div>

</header>

<main class="game">

  <!-- PLAY block -->
  <div class="game__framewrap">
    <iframe id="gameFrame" class="game__iframe" src="/webgl/chompocalypse/index.html" allowfullscreen></iframe>
  </div>
</main>

<footer class="footer footer--game">
  <div class="footer__left">
    <img src="/img/logo.png" alt="Ripple Games logo" class="logo logo--sm" />
    <span>LOGOS &amp; Disclaimer</span>
  </div>

</footer>

<script>
  (function fitAnyUnity(iframeId){
    const iframe = document.getElementById(iframeId);

    function getDoc(){ return iframe.contentDocument || iframe.contentWindow?.document; }
    function getCanvas(doc){
      return doc.getElementById('unity-canvas')
              || doc.querySelector('canvas[id*="unity"]')
              || doc.querySelector('canvas');
    }
    function getIntrinsicSize(canvas){
      const w = +canvas.getAttribute('width')  || canvas.width  || 960;
      const h = +canvas.getAttribute('height') || canvas.height || 600;
      return {w,h};
    }
    function fit(){
      const doc = getDoc(); if(!doc) return;
      const canvas = getCanvas(doc); if(!canvas) return;

      // prevent inner scrollbars
      doc.documentElement.style.overflow = 'hidden';
      doc.body.style.overflow = 'hidden';

      // read natural render size
      const {w:cw,h:ch} = getIntrinsicSize(canvas);

      // size of our iframe viewport
      const rect = iframe.getBoundingClientRect();
      const scale = Math.min(rect.width/cw, rect.height/ch);

      // ensure the canvas isn't already stretched by inner CSS
      Object.assign(canvas.style, {
        position: 'absolute',
        width:  cw+'px',
        height: ch+'px',
        transformOrigin: 'top left',
        transform: `scale(${scale})`
      });

      // center it (letterbox)
      const x = (rect.width  - cw*scale)/2;
      const y = (rect.height - ch*scale)/2;
      canvas.style.left = Math.max(0, x) + 'px';
      canvas.style.top  = Math.max(0, y) + 'px';

      // make sure its parent doesn't add layout
      const container = canvas.parentElement;
      if (container){
        Object.assign(container.style, {
          position:'absolute', inset:'0', overflow:'hidden', background:'#000'
        });
      }
    }

    iframe.addEventListener('load', () => {
      // try repeatedly while Unity boots (canvas may appear/resize)
      let tries = 0;
      const t = setInterval(()=>{ fit(); if(++tries>80) clearInterval(t); },100);

      // observe inner changes (Unity swaps sizes)
      const doc = getDoc(); if(doc){
        new MutationObserver(fit).observe(doc.documentElement,{subtree:true,attributes:true,childList:true});
      }

      // refit when outer size changes
      new ResizeObserver(fit).observe(iframe);
      window.addEventListener('resize', fit);
    });
  })('gameFrame');
</script>

</body>
</html>